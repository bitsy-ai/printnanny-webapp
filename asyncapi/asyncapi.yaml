---
asyncapi: "2.4.0"
id: "urn:ai:printnanny:dispatch:api"
info:
  title: PrintNanny Raspberry Pi Command Dispatch API
  version: "1.0.0"

servers:
  local:
    url: "nats://localhost:4222"
    protocol: tcp
    description: "Local server used for development/testing"

  production:
    url: "nats://nats.printnanny.ai"
    protocol: tcp
    description: "Production NATS server"

tags:
  - name: pi

channels:
  pi/{pi_id}/command:
    parameters:
      pi_id:
        $ref: "#/components/parameters/pi_id"
    publish:
      tags:
        - name: pi
      message:
        $ref: "#/components/messages/PiCommand"
    subscribe:
      tags:
        - name: pi
      message:
        $ref: "#/components/messages/PiCommand"

  pi/{pi_id}/status:
    parameters:
      pi_id:
        $ref: "#/components/parameters/pi_id"
    publish:
      tags:
        - name: pi
      message:
        $ref: "#/components/messages/PiStatus"
    subscribe:
      tags:
        - name: pi
      message:
        $ref: "#/components/messages/PiStatus"

components:
  parameters:
    pi_id:
      description: Raspberry Pi id
      schema:
        type: number
      location: $message.payload#/pi
  messages:
    PiStatus:
      name: PiStatus

      schemaFormat: "application/vnd.oai.openapi+json;version=3.0.0"
      payload:
        $ref: "./openapi.yaml#/components/schemas/PolymorphicPiStatusRequest"
    PiCommand:
      name: PiCommand
      schemaFormat: "application/vnd.oai.openapi+json;version=3.0.0"
      payload:
        $ref: "./openapi.yaml#/components/schemas/PolymorphicPiCommandRequest"
