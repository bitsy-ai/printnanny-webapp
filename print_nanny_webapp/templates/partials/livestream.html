{% load static %}

<div class="col-12 col-lg-6 d-flex align-items-stretch">
  <div class="card">
    <div class="card-body">
        <h2 class="header-title"><i class="mdi mdi-printer-3d"></i>
          <i class="mdi mdi-video-box-off"></i>{{object.name}} livestream</h2>
          <div id="stream-loading-{{object.id}}" class="row">
            <div class="alert alert-info col-12 col-md-5" role="alert">
              <h4 class="alert-heading"><strong>{{object.name}}</strong> web camera is <strong>offline.</strong></h4>
              <p>Print Nanny couldn't find a live video stream for this device</p>
              <p><button class="btn btn-primary">Troubleshooting Guide</button></p>
              <p><a href="{% url 'dashboard:octoprint-devices:detail' pk=object.id%}"><button class="btn btn-secondary">Send Wake Command</button></a></p>

            </div>
            <img src="{% static 'images/sleep.svg' %}" style="opacity: 30%" class="col-md-6 offset-md-1 d-none d-md-block img-fluid float-right"/>
  
          </div>

        <img id="stream-{{object.id}}" class="img-fluid">
    </div>
  </div>
</div>
<script>
    const loading = document.querySelector('#stream-loading-{{object.id}}');
  
    const video = document.querySelector('#stream-{{object.id}}');
    
    const WS_URL = "{{ WS_BASE_URL }}/{{object.id}}/video/download/";
    const ws = new WebSocket(WS_URL);
  
    ws.onmessage = (msg) => {
      console.log(msg)
      video.src = "data:image/png;base64," + msg.data
      loading.style.display = 'none';
    }
    ws.onopen = () => {
      console.log(`Connected to ${WS_URL}`);
    }
</script>